### 汇编语言讲解（三）



下面我们将开始编写完整的汇编语言程序，用编译器将他们编译成可执行文件（如：*.exe)，在操作系统中运行。

#### 编写汇编源程序

- 使用文本编辑器(如记事本，Nodepad++等)，用汇编语言编写汇编源程序。

- 使用汇编语言编译程序（MASM.exe)对源程序文件中的源程序进行编译，产生目标文件。
- 再用连接程序（LINK.exe)对目标文件进行连接，生成可在操作系统中直接运行的可执行文件。



##### 可执行文件中包含两部分内容

程序（从原程序中的汇编指令翻译过来的机器码）和数据（源程序中定义的数据） 



##### 执行可执行文件中的程序

操作系统依照可执行文件中的描述信息，将可执行文件中的机器码和数据加载入内存，并进行相关的初始化（比如：设置CS：IP指向第一条要执行的指令），然后由cpu执行程序。

![1581074387211](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1581074387211.png)



#### 源程序

![1581076749700](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1581076749700.png)

**汇编指令**：有对应的机器码的指令，可以被编译为机器指令，最终为cpu所执行

**伪指令**：没有对应的机器码的指令，最终不被cpu所执行； 谁来执行伪指令？伪指令是由编译器来执行的指令，编译器根据伪指令来进行相关的编译工作

```
定义一个段：segment 和 ends 是一成对使用的伪指令，这是在写可被编译器编译的汇编程序时，必须要用到的一对伪指令

segment和ends的功能是定义一个段，segment说明一个段开始，ends说明一个段结束；
一个段必须有一个名称来标识，使用格式为：
	段名 segment
	段名 ends
	
end 是汇编程序的结束标记，编译器在编译汇编程序的过程中，如果碰到了伪指令end，就结束对源程序的编译；如果程序写完了，要在结尾处加上伪指令end。否则，编译器在编译程序时，无法知道程序在何处结束。永远存在内存中，僵尸。

assume ：假如，寄存器与段的关联假设，它假设某一段寄存器和程序中的某一个segment...ends定义的段相关联。通过assume说明这种关联，在需要的情况下，编译程序可以将段寄存器和某一个具体的段相联系
```

一个汇编程序是由多个段组成的，这些段被用来存放代码、数据或当作栈空间来使用，一个有意义的汇编程序中至少有一个段，这个段用来存放代码

#### 源程序中的 "程序"

汇编源程序：

- 伪指令（编译器处理）
- 汇编指令（编译为机器码）

程序：源程序中最终由计算机执行，处理的指令或数据。

**注意**：我们可以将源程序文件中的所有内容称为源程序，将源程序中最终由计算机执行处理的指令或数据，称为程序。程序最先以汇编指令的形式存在源程序中，经编译、连接后转变为机器码，存储在可执行文件中。

![1581077115041](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1581077115041.png)



#### 标号

一个标号指代了一个地址；

codesg：放在segment的前面，作为一个段的名称，这个段的名称最总将被编译、连接程序处理为一个段的段地址。



**任务**

编程运算2^3

```
定义一个段；
实现处理任务；
程序结束；
段与段寄存器关联；

assume cs:abc
abc segment
	mov ax,2
	add ax,ax
	add ax,ax
	abc ends
end
```



#### DOS是一个单任务操作系统

​	一个程序P2在执行文件中，则必须有一个正在运行的程序P1，将P2从可执行文件中加载入内存后，将cpu的控制权交给P2，P2才能得以运行，P2开始运行后，P1暂停运行。

现在我们知道，一个程序结束后，将cpu的控制权交还给使得它得以运行的程序，我们称这个过程为：**程序返回**

```
程序返回：
	应该在程序的末尾添加返回的程序段。
	mov ax,4c00H
	int 21H
	这两条指令所实现的功能就是程序返回
```

1.asm文件：

```assembly
assume cs:abc

abc segment
    mov ax,2
    add ax,ax
    add ax,ax

    mov  ax,4c00H
    int 21H
abc ends

end

```

使用步骤，需要配置DOSBox：<https://blog.csdn.net/hjw1542254356/article/details/79721546>

![1581081446555](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1581081446555.png)